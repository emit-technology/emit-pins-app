(()=>{"use strict";var e={95624:(e,t,n)=>{var r,o,i,s,c,u;(u=r=r||{})[u._=0]="_",u[u.init=1]="init",u[u.getPinnedMessageArray=2]="getPinnedMessageArray",u[u.checkAlive=3]="checkAlive",u[u.listenerMessage=4]="listenerMessage",function(e){e.Dice="dice",e.Role="role",e.Text="text",e.Expression="expression",e.Theme="theme",e.Airdrop="airdrop",e.Support="support",e.Divide="divide",e.UpdateTribe="updateTribe",e.Pin="pin"}(o=o||{}),function(e){e[e.dashed=0]="dashed",e[e.draft=1]="draft",e[e.pinned=2]="pinned",e[e.removed=3]="removed"}(i=i||{}),function(e){e.Random="random",e.Average="average"}(s=s||{}),function(e){e[e._=0]="_",e[e.inactive=1]="inactive",e[e.active=2]="active",e[e.tokenInvalid=3]="tokenInvalid"}(c=c||{});var a=n(93505),l=n.n(a),f=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}};const h={development:{version:5,source:"emit-im",host:{ws:"wss://pins-ws.emit.technology/ws",rpc:"https://pins-api.emit.technology"}},production:{version:5,source:"emit-im",host:{ws:"wss://pins-ws.emit.technology/ws",rpc:"https://pins-api.emit.technology"}}}.production;var p=n(54707);const v=function(){};var b={message:{name:"message",keyPath:"uid",autoIncrement:!0,indexes:[{index:"id",relativeIndex:"id",unique:!0},{index:"groupId",relativeIndex:"groupId",unique:!1},{index:"tribeId",relativeIndex:"tribeId",unique:!1},{index:"tribeIdDeleted",relativeIndex:"tribeIdDeleted",unique:!1},{index:"deleted",relativeIndex:"deleted",unique:!1},{index:"timestamp",relativeIndex:"timestamp",unique:!1},{index:"seq",relativeIndex:"seq",unique:!1},{index:"tribeIdAndTimestamp",relativeIndex:["tribeId","deleted","timestamp"],unique:!1},{index:"tribeIdAndGroupId",relativeIndex:["tribeId","groupId"],unique:!1},{index:"tribeIdAndSeq",relativeIndex:["tribeId","seq"],unique:!1},{index:"tribeIdDeletedAndSeq",relativeIndex:["tribeId","deleted","seq"],unique:!1}]},groupMsg:{name:"group_msg",keyPath:"uid",autoIncrement:!0,indexes:[{index:"groupId",relativeIndex:"groupId",unique:!0}]},tribeInfo:{name:"tribe_info",keyPath:"uid",autoIncrement:!0,indexes:[{index:"tribeId",relativeIndex:"tribeId",unique:!0}]}},g=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},w=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},m=function(e){function t(t){var n=e.call(this)||this;return n.findPages=function(e,t,r,o,i,s){return y(n,void 0,void 0,(function(){return w(this,(function(n){switch(n.label){case 0:return[4,this._db.pageData(this._name,e,t,r,o,i,s)];case 1:return[2,n.sent()]}}))}))},n._name=b.message.name,n._db=t,n}return g(t,e),t.prototype.delete=function(e){return y(this,void 0,void 0,(function(){return w(this,(function(t){switch(t.label){case 0:return[4,this._db.delete(this._name,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.find=function(e){return y(this,void 0,void 0,(function(){var t;return w(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return(t=n.sent())?[2,t[0]]:[2,null]}}))}))},t.prototype.some=function(e){return y(this,void 0,void 0,(function(){var t;return w(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return(t=n.sent())?[2,t]:[2,[]]}}))}))},t.prototype.findAll=function(){return y(this,void 0,void 0,(function(){return w(this,(function(e){switch(e.label){case 0:return[4,this._db.selectAll(this._name)];case 1:return[2,e.sent()]}}))}))},t.prototype.insert=function(e){return y(this,void 0,void 0,(function(){return w(this,(function(t){switch(t.label){case 0:return[4,this._db.insert(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.insertMany=function(e){return y(this,void 0,void 0,(function(){return w(this,(function(t){switch(t.label){case 0:return[4,this._db.insertMany(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){return y(this,void 0,void 0,(function(){return w(this,(function(t){switch(t.label){case 0:return[4,this._db.update(this._name,e)];case 1:return[2,t.sent()]}}))}))},t}(v);const I=m;var _=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},k=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},P=function(e){function t(t){var n=e.call(this)||this;return n.findPages=function(e,t,r,o,i){return x(n,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return[4,this._db.pageData(this._name,e,t,r,o,i)];case 1:return[2,n.sent()]}}))}))},n._name=b.groupMsg.name,n._db=t,n}return _(t,e),t.prototype.delete=function(e){return x(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this._db.delete(this._name,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.find=function(e){return x(this,void 0,void 0,(function(){var t;return k(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return[2,(t=n.sent())&&t[0]]}}))}))},t.prototype.findAll=function(){return x(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return[4,this._db.selectAll(this._name)];case 1:return[2,e.sent()]}}))}))},t.prototype.insert=function(e){return x(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this._db.insert(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){return x(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this._db.update(this._name,e)];case 1:return[2,t.sent()]}}))}))},t}(v);const T=P;var M=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),S=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},O=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},q=function(e){function t(t){var n=e.call(this)||this;return n.findPages=function(e,t,r,o,i){return S(n,void 0,void 0,(function(){return O(this,(function(n){switch(n.label){case 0:return[4,this._db.pageData(this._name,e,t,r,o,i)];case 1:return[2,n.sent()]}}))}))},n._name=b.tribeInfo.name,n._db=t,n}return M(t,e),t.prototype.delete=function(e){return S(this,void 0,void 0,(function(){return O(this,(function(t){switch(t.label){case 0:return[4,this._db.delete(this._name,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.find=function(e){return S(this,void 0,void 0,(function(){var t;return O(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return[2,(t=n.sent())&&t[0]]}}))}))},t.prototype.findAll=function(){return S(this,void 0,void 0,(function(){return O(this,(function(e){switch(e.label){case 0:return[4,this._db.selectAll(this._name)];case 1:return[2,e.sent()]}}))}))},t.prototype.insert=function(e){return S(this,void 0,void 0,(function(){return O(this,(function(t){switch(t.label){case 0:return[4,this._db.insert(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){return S(this,void 0,void 0,(function(){return O(this,(function(t){switch(t.label){case 0:return[4,this._db.update(this._name,e)];case 1:return[2,t.sent()]}}))}))},t}(v);const A=q;var C=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},D=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},j=function(){function e(e,t){var n=this;this.addMultiple=function(e){return C(n,void 0,void 0,(function(){var t=this;return D(this,(function(n){return[2,new Promise((function(n,r){var o=t.transaction();e.forEach((function(e){(e=o.objectStore(t.name).add(e)).onsuccess=function(e){console.log("add data success!")},e.onerror=function(e){console.error("add data error!",e)}})),o.oncomplete=function(e){n(!0)}}))]}))}))},this.name=e,this.db=t}return e.prototype.transaction=function(e){return this.db.transaction([this.name],!0===(e=void 0===e||e)?"readwrite":"readonly")},e.prototype.request=function(){return this._store||(this._store=this.transaction().objectStore(this.name)),this._store},e.prototype.select=function(e){return C(this,void 0,void 0,(function(){var t,n,r,o,i,s,c,u,a,l,f,d,h,p,v,b,g,y=this;return D(this,(function(w){switch(w.label){case 0:if(1!=Object.keys(e).length)return[3,1];for(r in e)n=e[t=r];return[2,new Promise((function(e,r){var o=y.request().index(t).getAll(IDBKeyRange.only(n),1);o.onsuccess=function(t){e(t.target.result)},o.onerror=function(e){r(e)}}))];case 1:for(s in o=[],i=[],e)i.push(s);c=0,w.label=2;case 2:return c<i.length?(u=i[c],[4,this._iSelect(u,e[u])]):[3,5];case 3:u=w.sent(),o.push(u),w.label=4;case 4:return c++,[3,2];case 5:for(a=[],l=0,f=o;l<f.length;l++)for(d=f[l],h=0,p=d;h<p.length;h++){for(g in v=p[h],b=!0,e)if(v[g]!=e[g]){b=!1;break}b&&a.push(v)}return[2,a]}}))}))},e.prototype._iSelect=function(e,t){return C(this,void 0,void 0,(function(){var n=this;return D(this,(function(r){return[2,new Promise((function(r,o){var i=n.request().index(e).getAll(t);i.onsuccess=function(e){r(e.target.result)},i.onerror=function(e){o(e.target.result)}}))]}))}))},e.prototype.selectId=function(e){var t=this;return new Promise((function(n,r){var o=t.request().get(e);o.onsuccess=function(e){n(e.target.result)},o.onerror=function(e){r(e.target.result)}}))},e.prototype.selectAll=function(){var e=this;return new Promise((function(t,n){var r=e.request().getAll();r.onsuccess=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.result)}}))},e.prototype.some=function(e,t){var n,r,o,i=this;for(o in e)r=e[n=o];return new Promise((function(e,o){var s=[];i.request().index(n).openCursor(r,"prev").onsuccess=function(n){(n=n.target.result)&&(s.push(n.value),s.length<t)?n.continue():e(s)}}))},e.prototype.pageData=function(e,t,n,r,o,i){var s=this;return void 0===o&&(o=10),void 0===i&&(i=!0),new Promise((function(c,u){var a=[],l=s.request().index(e),f=n?IDBKeyRange.bound(t,n):IDBKeyRange.only(t),d=l.openCursor(f,i?"prev":"next"),h=l.count(f),p=null;d.onsuccess=function(e){(e=e.target.result)?p===o-1?(a.push(e.value),c({data:a,total:h?h.result:0})):null===p&&1!==r?(p=0,e.advance((r-1)*o)):(p++,a.push(e.value),e.continue()):c({data:a,total:0})},d.onerror=function(e){console.log("read data failed",e),u(e)}}))},e.prototype.update=function(e){var t=this;return new Promise((function(n,r){var o=t.request().put(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}}))},e.prototype.insert=function(e){var t=this;return new Promise((function(n,r){var o=t.request().add(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}}))},e.prototype.delete=function(e){var t=this;return new Promise((function(n,r){t.select(e).then((function(r){r.length?r.forEach((function(r,o,i){var s,c=(s=t.request()).keyPath;(s=s.delete(r[c])).onsuccess=function(e){o===i.length-1&&n(e)},s.onerror=function(t){console.log("delete error: ",e,r,o,t),o===i.length-1&&n(!0)}})):n(!0)})).catch((function(e){r(e)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){var r=e.request().clear();r.onsuccess=function(e){t(e)},r.onerror=function(e){n(e)}}))},e}(),E=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},G=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},N=function(){function e(e){var t=e.databaseName,n=e.tables;e=e.version;this.name=t,this.tables=n,this.createTable(this.tables,e)}return e.prototype.createDateBase=function(e,t){void 0===t&&(t=1),this.openedDB=indexedDB.open(e,t)},e.prototype.createTable=function(e,t){var n=this;void 0===t&&(t=1),indexedDB.open(this.name,t).onupgradeneeded=function(t){var r=t.target.result;e.forEach((function(e){var t;Array.from(r.objectStoreNames).includes(e.name)||(t=r.createObjectStore(e.name,{keyPath:e.keyPath,autoIncrement:e.autoIncrement}),e.indexes.forEach((function(e){n.createIndex(t,e)})))}))}},e.prototype.deleteTable=function(e,t){indexedDB.open(this.name,t).onupgradeneeded=function(n){var r=n.target.result;n.oldVersion<t&&r.deleteObjectStore(e)}},e.prototype.createIndex=function(e,t){var n={};t.unique&&(n.unique=t.unique),t.multiEntry&&(n.multiEntry=t.multiEntry),e.createIndex(t.index,t.relativeIndex,n)},e.prototype.connect=function(){var e=this;return new Promise((function(t,n){var r=indexedDB.open(e.name,e.version);r.onsuccess=function(e){t(e.target.result)},r.onerror=function(e){n(e)}}))},e.prototype.close=function(){this.connect().then((function(e){e.close()}))},e.prototype.insert=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new j(e,n).insert(t).then(r).catch(o)}))}))},e.prototype.insertMany=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new j(e,n).addMultiple(t).then(r).catch(o)}))}))},e.prototype.select=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new j(e,n).select(t).then((function(e){r(e)})).catch((function(e){o(e)}))}))}))},e.prototype.selectId=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new j(e,n).selectId(t).then((function(e){r(e)})).catch((function(e){o(e)}))}))}))},e.prototype.some=function(e,t,n){var r=this;return new Promise((function(o,i){r.connect().then((function(r){new j(e,r).some(t,n).then((function(e){o(e)})).catch((function(e){i(e)}))}))}))},e.prototype.pageData=function(e,t,n,r,o,i,s){var c=this;return new Promise((function(u,a){c.connect().then((function(c){new j(e,c).pageData(t,n,r,o,i,s).then((function(e){u(e)})).catch((function(e){a(e)}))}))}))},e.prototype.update=function(e,t){return E(this,void 0,void 0,(function(){var n=this;return G(this,(function(r){return[2,new Promise((function(r,o){n.connect().then((function(n){new j(e,n).update(t).then((function(e){r(e)})).catch((function(n){console.log(e,t),console.log(n),r(!0)}))}))}))]}))}))},e.prototype.delete=function(e,t){return E(this,void 0,void 0,(function(){var n=this;return G(this,(function(r){return[2,new Promise((function(r,o){n.connect().then((function(n){new j(e,n).delete(t).then((function(e){r(e)})).catch((function(n){console.log(e,t),console.log(n),r(!0)}))}))}))]}))}))},e.prototype.selectAll=function(e){var t=this;return new Promise((function(n,r){t.connect().then((function(t){new j(e,t).selectAll().then((function(e){n(e)})).catch((function(e){r(e)}))}))}))},e.prototype.clearTable=function(e){var t=this;return new Promise((function(n,r){t.connect().then((function(t){new j(e,t).clear().then((function(e){n(e)})).catch((function(e){r(e)}))}))}))},e}(),W=function(){function e(){}return e.prototype.initDatabase=function(e,t){void 0===t&&(t=1);for(var n=[],r=0,o=Object.keys(b);r<o.length;r++){var i=o[r];n.push(b[i])}return new N({databaseName:e,tables:n,version:t})},e}(),B=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),L=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},R=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},J=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},K=function(e){function t(){var t=e.call(this,h.host.rpc)||this,r=(t.db_init=0,t.init_count=0,t.initDb=function(e){0==t.db_init++&&(t._db=(new W).initDatabase("emit_im_".concat(e),h.version),t.messageCollection=new I(t._db),t.groupMsgCollection=new T(t._db),t.tribeInfoCollection=new A(t._db))},t.initCacheMsg=function(){return L(t,void 0,void 0,(function(){var e,t,n,r;return R(this,(function(o){switch(o.label){case 0:return[4,this.getMessageCollection(this.tribeId).findAll()];case 1:if((e=o.sent())&&0<e.length)for(t=0,n=e;t<n.length;t++)r=n[t],this.cacheMsg.set(r.id,!0);return[2]}}))}))},t.getMessageCollection=function(e){return t.initDb(e),t.messageCollection},t.getGroupMsgCollection=function(e){return t.initDb(e),t.groupMsgCollection},t.getTribeInfoCollection=function(e){return t.initDb(e),t.tribeInfoCollection},t.init=function(e,n,r){return L(t,void 0,void 0,(function(){var t;return R(this,(function(o){switch(o.label){case 0:return 0!=this.init_count++?[3,3]:(console.log("init tribe worker service ..."),this.tribeId=e,this.authToken=n,this._cb=r,t=Date.now(),[4,this.indexGroupMsg()]);case 1:return o.sent(),console.log("-----------\x3e indexedGroupMsg cost: ",Date.now()-t),[4,this.setConnectWs()];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},t.terminal=function(){t._wsOrigin&&(t._wsOrigin.close(),t._wsOrigin=null),t._wsIntervalId&&clearInterval(t._wsIntervalId)},t.tribeInfo=function(){return L(t,void 0,void 0,(function(){var e;return R(this,(function(t){switch(t.label){case 0:return[4,this.post("/tribe/tribeInfo",{tribeId:this.tribeId},this.authToken)];case 1:return(e=t.sent())&&0==e.code?[2,Promise.resolve(e.data)]:[2,Promise.reject(e.message)]}}))}))},t.tribeRoles=function(){return L(t,void 0,void 0,(function(){var e;return R(this,(function(t){switch(t.label){case 0:return[4,this.post("/tribe/tribeRoles",{tribeId:this.tribeId},this.authToken)];case 1:return(e=t.sent())&&0==e.code?e.data?[2,Promise.resolve(e.data)]:[2,[]]:[2,Promise.reject(e.message)]}}))}))},t.userCheckAuth=function(){return L(t,void 0,void 0,(function(){var e;return R(this,(function(t){switch(t.label){case 0:return[4,this.post("/user/checkAuth",null,this.authToken)];case 1:return(e=t.sent())&&0==e.code?[2,Promise.resolve(e.data.userName)]:(this.latestErrorToken=this.authToken,[2,Promise.reject(e.message)])}}))}))},t.addWsListener=function(e){var n,r,o,i=t.authToken,s=t.tribeId;t._wsOrigin&&(t._wsOrigin.addEventListener("open",(function(e){console.log("opened"),t._status=c.active,t._wsOrigin.send(JSON.stringify({tribeId:s,authToken:i})),r()})),t._wsOrigin.addEventListener("close",(function(e){console.log("closed"),t._status=c.inactive})),t._wsOrigin.addEventListener("error",(function(e){console.log("error, connect after 10s later:",e),t._status=c.inactive})),t._wsOrigin.addEventListener("message",(function(n){t._status=c.active,n.data&&-1<n.data.indexOf("pong")?o():e?e(n.data):console.log("unset service callback function!")})),n=function(){t._status=c.inactive,console.log("pong timeout ,reconnect...")},r=function(){setTimeout((function(){t._wsOrigin.send("ping"),t.pongTimeout=setTimeout((function(){n()}),1e4)}),1e4)},o=function(){clearTimeout(t.pongTimeout),r()})},t.connectOrigin=function(e){var n=t.tribeId;t._cbInner=e,console.log("connect to [%s] websocket....",n),t.connect()},t.connect=function(){t._wsOrigin?(console.log("check ws status=[%d]",WebSocket[t._wsOrigin.readyState]),t._wsOrigin.readyState==WebSocket.CLOSED?(t._wsOrigin=new WebSocket(h.host.ws),t.addWsListener(t._cbInner)):t._wsOrigin.readyState==WebSocket.OPEN&&t._wsOrigin.send(JSON.stringify({tribeId:t.tribeId,authToken:t.authToken}))):(console.log("ws is null, new web socket, cb: ",t._cbInner),t._cbInner?(t._wsOrigin=new WebSocket(h.host.ws),t.addWsListener(t._cbInner)):console.log("not set service callback function..."))},t.reconnect=function(){console.log("websocket reconnect... ws status = ",t._status);try{t.userCheckAuth().then((function(){t.connect()})).catch((function(e){console.error(e),t._status=c.tokenInvalid}))}catch(r){console.error(r)}},t.indexGroupMsg=function(){return L(t,void 0,void 0,(function(){var e,t;return R(this,(function(n){switch(n.label){case 0:return[4,this.groupIds()];case 1:return e=n.sent(),[4,this.tribeInfo()];case 2:return t=n.sent(),[4,this.storeTribeInfoIndex(t)];case 3:return n.sent(),[4,this.createGroupMsg(e,!0)];case 4:return[2,n.sent()]}}))}))},t.groupIds=function(){return L(t,void 0,void 0,(function(){var e;return R(this,(function(t){switch(t.label){case 0:return[4,this.post("/tribe/groupIds",{tribeId:this.tribeId},this.authToken)];case 1:return(e=t.sent())&&0==e.code?[2,Promise.resolve(e.data)]:[2,Promise.reject(e.message)]}}))}))},t._sortMsg=function(e,t){return e.timestamp-t.timestamp},t.createGroupMsg=function(e,n){return void 0===e&&(e=[]),void 0===n&&(n=!1),L(t,void 0,void 0,(function(){var t,r,s,c,u,a,l,f,d,h,v,b,g,y;return R(this,(function(w){switch(w.label){case 0:if(!e||0==e.length)return[2,Promise.resolve([])];t=[],h=0,w.label=1;case 1:return h<e.length?(b=e[h],[4,this.getGroupMsgCollection(this.tribeId).find({groupId:b})]):[3,4];case 2:(l=w.sent())||t.push({groupId:b,seq:h+1+""}),w.label=3;case 3:return h++,[3,1];case 4:if(r=[],!(0<t.length))return[3,18];s=[],c=0,u=t,w.label=5;case 5:return c<u.length?(a=u[c],[4,this.post("/tribe/groupedMsg",{groupIds:[a.groupId],withDraft:n},this.authToken)]):[3,16];case 6:return(l=w.sent())&&0==l.code?0==l.data.length?[2,Promise.reject("groupId =[".concat(e,"] con not match the results"))]:(d=l.data[0]).records&&0<d.records.length?((g=d.records).sort(this._sortMsg),(f=JSON.parse(JSON.stringify(g[0]))).msgType=o.Divide,f.msgStatus=i.pinned,f.seq=new p.Z(f.seq).minus(1).toString(10),f.timestamp=f.timestamp-1,f.id=f.id+Date.now(),console.log("========== create pinned message:",f),[4,this.storeMessageIndex([f],f.groupId,d.roles)]):[3,8]:[3,14];case 7:y=w.sent(),s.push.apply(s,y),(d=JSON.parse(JSON.stringify(f))).msgType=o.Pin,r.push(d),w.label=8;case 8:h=0,w.label=9;case 9:return h<l.data.length?(v=l.data[h],b=a.groupId,v.groupId=b,v.seq=a.seq,g=J([],v.records,!0),[4,this.storeMessageIndex(g,b,v.roles)]):[3,13];case 10:return y=w.sent(),s.push.apply(s,y),v.records=[],[4,this.getGroupMsgCollection(this.tribeId).insert(v)];case 11:w.sent(),w.label=12;case 12:return h++,[3,9];case 13:return[3,15];case 14:return[2,Promise.reject(l.message)];case 15:return c++,[3,5];case 16:return 0<s.length?[4,this.getMessageCollection(this.tribeId).insertMany(s)]:[3,18];case 17:w.sent(),w.label=18;case 18:return[2,Promise.resolve(r)]}}))}))},t._tribeIdDeletedKey=function(e){return e===i.removed||e===i.draft?1:2},t.storeMessageIndex=function(e,n,r){return L(t,void 0,void 0,(function(){var t,s,c,u,a,l,f;return R(this,(function(d){switch(d.label){case 0:Date.now(),t=this.getMessageCollection(this.tribeId),s=[],c=function(e){var c,a,l,f,d;return R(this,(function(h){switch(h.label){case 0:return e.msgType!=o.Pin?[3,3]:[4,u.clearUnPinnedMessages()];case 1:return h.sent(),[4,u.indexGroupMsg()];case 2:return h.sent(),[2,"continue"];case 3:return e.msgType==o.UpdateTribe?[2,"continue"]:(e.groupId=n,e.actor=r.find((function(t){return t.id==e.role})),e.deleted=u._tribeIdDeletedKey(e.msgStatus),e.tribeId=u.tribeId,[4,t.find({id:e.id})]);case 4:return(c=h.sent())?e.msgStatus!==i.removed?[3,7]:[4,t.delete({id:e.id})]:[3,10];case 5:return h.sent(),[4,t.insert(e)];case 6:return h.sent(),[3,9];case 7:for(a=Object.keys(e),l=0,f=a;l<f.length;l++)d=f[l],c[d]=e[d];return[4,t.update(c)];case 8:h.sent(),h.label=9;case 9:return[3,11];case 10:s.push(e),h.label=11;case 11:return u.cacheMsg.set(e.id,!0),[2]}}))},u=this,a=0,l=e,d.label=1;case 1:return a<l.length?(f=l[a],[5,c(f)]):[3,4];case 2:d.sent(),d.label=3;case 3:return a++,[3,1];case 4:return s.length,[2,s]}}))}))},t.clearUnPinnedMessages=function(){return L(t,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,this.getMessageCollection(this.tribeId).delete({groupId:""})];case 1:return e.sent(),[2]}}))}))},t.storeTribeInfoIndex=function(e){return L(t,void 0,void 0,(function(){var t,n,r,o,i;return R(this,(function(s){switch(s.label){case 0:return[4,this.getTribeInfoCollection(e.tribeId).find({tribeId:e.tribeId})];case 1:if(!(t=s.sent()))return[3,3];for(n=Object.keys(e),r=0,o=n;r<o.length;r++)i=o[r],t[i]=e[i];return[4,this.getTribeInfoCollection(e.tribeId).update(t)];case 2:return s.sent(),[3,5];case 3:return[4,this.getTribeInfoCollection(e.tribeId).insert(e)];case 4:s.sent(),s.label=5;case 5:return[2]}}))}))},t.getMessageWithPinned=function(e,n,r,s){return L(t,void 0,void 0,(function(){var t,c,u,a,l,f,d,h,p,v,b,g,y;return R(this,(function(w){switch(w.label){case 0:return t=[e,this._tribeIdDeletedKey(i.pinned),0],c=[e,this._tribeIdDeletedKey(i.pinned),Math.floor(Date.now()/1e3)+3600],y="tribeIdAndTimestamp",u=!0,s&&4==s.length&&(y=s[0],t=s[1],c=s[2],u=s[3]),console.log(y,t,c,"condition========="),[4,this.getMessageCollection(e).findPages(y,t,c,n,r,u)];case 1:return a=w.sent(),console.log("============== get rest : ",a),l=a.data,f=[],[4,this.getTribeInfoCollection(e).find({tribeId:e})];case 2:d=w.sent(),h=null,l.reverse(),p=0,v=l,w.label=3;case 3:return p<v.length?(b=v[p]).msgStatus===i.draft||b.msgStatus===i.removed?[3,7]:(h=b.msgType!==o.Divide&&b.msgType!==o.Role?(b.hideTime=h&&h.role==b.role&&h.groupId==b.groupId&&Math.floor(h.timestamp/300)==Math.floor(b.timestamp/300)?1:2,h&&(h.owner==d.keeper&&b.owner!==d.keeper||h.owner!==d.keeper&&b.owner==d.keeper)&&(b.groupId||(b.hideTime=2)),{role:b.role,timestamp:b.timestamp,groupId:b.groupId,owner:b.owner}):(b.hideTime=2,null),[4,this.getGroupMsgCollection(e).find({groupId:b.groupId})]):[3,8];case 4:return g=w.sent(),!b.replayToMsgId||b.replayMsg?[3,6]:[4,this.getMessageCollection(e).find({id:b.replayToMsgId})];case 5:(y=w.sent())&&(b.replayMsg=y),w.label=6;case 6:g?f.push({theme:g.theme,seq:g.seq,roles:g.roles,records:[b],groupId:g.groupId,index:0}):d&&f.push({theme:d.theme,seq:"",roles:d.roles,records:[b],groupId:"",index:0}),w.label=7;case 7:return p++,[3,3];case 8:return[2,{total:a.total,data:f}]}}))}))},t.status=function(e,n){return t.authToken=n,t.tribeId=e,t._status!==c.active?t.reconnect():t.authToken=n,t._status},t.setConnectWs=function(){t.connectOrigin((function(e){return L(t,void 0,void 0,(function(){var t,n,r,i,s,c,u,a,l,f,d,h,v,b,g,y;return R(this,(function(w){switch(w.label){case 0:return[4,this._lock()];case 1:t=w.sent(),w.label=2;case 2:return w.trys.push([2,15,16,17]),(a=JSON.parse(e)).msgs?(n=a.msgs,r=a.tribeInfo,s=i=r,[4,this.tribeRoles()]):[3,14];case 3:return s.roles=w.sent(),[4,this.storeTribeInfoIndex(r)];case 4:return w.sent(),[4,this.indexGroupMsg()];case 5:return c=w.sent(),u=J([],n,!0),[4,this.getMessageCollection(i.tribeId).findPages("tribeIdDeletedAndSeq",[i.tribeId,2,"0000000000000000000"],[i.tribeId,2,new p.Z(1e20).minus(1).toString(10)],1,2)];case 6:a=w.sent(),console.log("rest",a),0<a.data.length&&(l=a.data[0].seq,u=u.filter((function(e){return e.msgType==o.Pin||e.msgType==o.UpdateTribe||0<new p.Z(e.seq).comparedTo(new p.Z(l))}))),u=u.filter((function(e){return e.msgType!=o.Support})),f=[],d=function(e){var t;return R(this,(function(n){switch(n.label){case 0:return e.replayToMsgId?(t=u.find((function(t){return t.id==e.replayToMsgId})))?[3,2]:[4,h.getMessageCollection(i.tribeId).find({id:e.replayToMsgId})]:[3,3];case 1:t=n.sent(),n.label=2;case 2:e.replayMsg=t,n.label=3;case 3:return f.push(e),[2]}}))},h=this,v=0,b=u,w.label=7;case 7:return v<b.length?(g=b[v],[5,d(g)]):[3,10];case 8:w.sent(),w.label=9;case 9:return v++,[3,7];case 10:return 0<f.length?[4,this.storeMessageIndex(f,"",i.roles)]:[3,14];case 11:return(g=w.sent())&&0<g.length?[4,this.getMessageCollection(i.tribeId).insertMany(g)]:[3,13];case 12:w.sent(),w.label=13;case 13:this._cb?(f.push.apply(f,c),f.sort(this._sortMsg),y=this.convertMessagesToPinnedSticky(f,i.roles,r),this._cb(y)):console.log("unset callback function"),w.label=14;case 14:return[3,17];case 15:return y=w.sent(),console.error(y),[3,17];case 16:return t(),console.log("release ..."),[7];case 17:return[2]}}))}))}))},t.convertMessagesToPinnedSticky=function(e,t,n){if(e&&n&&t){for(var r=[],o=0,i=e;o<i.length;o++){var s=i[o];r.push({theme:n.theme,seq:s.seq,roles:t,records:[s],groupId:"",index:0})}return r}return[]},n(67841));return t._lock=r(),t._status=c._,t.cacheMsg=new Map,t}return B(t,e),t}((function(e){var t=this;this.post=function(e,n,r){return f(t,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,l().post("".concat(this._url).concat(e),n,{headers:{"Content-Type":"application/json",AuthToken:r}})];case 1:return[2,t.sent().data]}}))}))},this._url=e})),U=function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},Z=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:c(0),throw:c(1),return:c(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){var u=[s,c];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},z=new function(){var e=this;this.count=0,this.init=function(t,n){return U(e,void 0,void 0,(function(){var e;return Z(this,(function(o){switch(o.label){case 0:return 0!=this.count++?[3,2]:(e=function(e){console.log("callback msg",e),F({messageId:-1,method:r.listenerMessage,data:e,result:e})},[4,this.tribeService.init(t,n,e)]);case 1:o.sent(),o.label=2;case 2:return[2,Promise.resolve(!0)]}}))}))},this.getPinnedMessageArray=function(t,n,r,o){return U(e,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.tribeService.getMessageWithPinned(t,n,r,o)];case 1:return[2,e.sent()]}}))}))},this.checkStatusAndSetAuthToken=function(t,n){return U(e,void 0,void 0,(function(){return Z(this,(function(e){return[2,this.tribeService.status(t,n)]}))}))},this.tribeService=new K};function F(e){self.postMessage(e)}self.addEventListener("message",(function(e){if(e&&e.data&&e.data.method){var t=e.data;switch(t.method){case r.init:z.init(t.data.tribeId,t.data.authToken).then((function(e){t.result=e,F(t)})).catch((function(e){t.error="string"==typeof e?e:e.message,F(t)}));break;case r.getPinnedMessageArray:z.getPinnedMessageArray(t.data.tribeId,t.data.pageNo,t.data.pageSize,t.data.conditions).then((function(e){t.result=e,F(t)})).catch((function(e){t.error="string"==typeof e?e:e.message,F(t)}));break;case r.checkAlive:z.checkStatusAndSetAuthToken(t.data.tribeId,t.data.authToken).then((function(e){t.result=e,F(t)})).catch((function(e){t.error="string"==typeof e?e:e.message,F(t)}));break;default:console.log("default message",t)}}}))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.m=e,n.x=()=>{var e=n.O(void 0,[655],(()=>n(95624)));return e=n.O(e)},(()=>{var e=[];n.O=(t,r,o,i)=>{if(!r){var s=1/0;for(l=0;l<e.length;l++){for(var[r,o,i]=e[l],c=!0,u=0;u<r.length;u++)(!1&i||s>=i)&&Object.keys(n.O).every((e=>n.O[e](r[u])))?r.splice(u--,1):(c=!1,i<s&&(s=i));if(c){e.splice(l--,1);var a=o();void 0!==a&&(t=a)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[r,o,i]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".c50da93b.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/",(()=>{var e={624:1};n.f.i=(t,r)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkemit_pins=self.webpackChunkemit_pins||[],r=t.push.bind(t);t.push=t=>{var[o,i,s]=t;for(var c in i)n.o(i,c)&&(n.m[c]=i[c]);for(s&&s(n);o.length;)e[o.pop()]=1;r(t)}})(),(()=>{var e=n.x;n.x=()=>n.e(655).then(e)})();n.x()})();