(()=>{"use strict";var e={83838:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baseConfig=void 0;t.default=function(){},t.baseConfig={message:{name:"message",keyPath:"uid",autoIncrement:!0,indexes:[{index:"id",relativeIndex:"id",unique:!0},{index:"groupId",relativeIndex:"groupId",unique:!1},{index:"tribeId",relativeIndex:"tribeId",unique:!1},{index:"tribeIdDeleted",relativeIndex:"tribeIdDeleted",unique:!1},{index:"deleted",relativeIndex:"deleted",unique:!1},{index:"timestamp",relativeIndex:"timestamp",unique:!1},{index:"seq",relativeIndex:"seq",unique:!1},{index:"tribeIdAndTimestamp",relativeIndex:["tribeId","deleted","timestamp"],unique:!1},{index:"tribeIdAndGroupId",relativeIndex:["tribeId","groupId"],unique:!1},{index:"tribeIdAndSeq",relativeIndex:["tribeId","seq"],unique:!1},{index:"tribeIdDeletedAndSeq",relativeIndex:["tribeId","deleted","seq"],unique:!1}]},groupMsg:{name:"group_msg",keyPath:"uid",autoIncrement:!0,indexes:[{index:"groupId",relativeIndex:"groupId",unique:!0}]},tribeInfo:{name:"tribe_info",keyPath:"uid",autoIncrement:!0,indexes:[{index:"tribeId",relativeIndex:"tribeId",unique:!0}]}}},96765:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),n(83838)),a=function(e){function t(t){var n=e.call(this)||this;return n.findPages=function(e,t,r,s,a){return o(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this._db.pageData(this._name,e,t,r,s,a)];case 1:return[2,n.sent()]}}))}))},n._name=s.baseConfig.groupMsg.name,n._db=t,n}return r(t,e),t.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.delete(this._name,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return[2,(t=n.sent())&&t[0]]}}))}))},t.prototype.findAll=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._db.selectAll(this._name)];case 1:return[2,e.sent()]}}))}))},t.prototype.insert=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.insert(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.update(this._name,e)];case 1:return[2,t.sent()]}}))}))},t}(s.default);t.default=a},91932:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBClass=void 0;var r=n(72698),o=n(83838),i=function(){function e(){}return e.prototype.initDatabase=function(e,t){void 0===t&&(t=1);for(var n=[],i=0,s=Object.keys(o.baseConfig);i<s.length;i++){var a=s[i];n.push(o.baseConfig[a])}return new r.IndexedDB({databaseName:e,tables:n,version:t})},e}();t.IndexedDBClass=i},76710:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),n(83838)),a=function(e){function t(t){var n=e.call(this)||this;return n.findPages=function(e,t,r,s,a){return o(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this._db.pageData(this._name,e,t,r,s,a)];case 1:return[2,n.sent()]}}))}))},n._name=s.baseConfig.message.name,n._db=t,n}return r(t,e),t.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.delete(this._name,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return(t=n.sent())?[2,t[0]]:[2,null]}}))}))},t.prototype.some=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return(t=n.sent())?[2,t]:[2,[]]}}))}))},t.prototype.findAll=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._db.selectAll(this._name)];case 1:return[2,e.sent()]}}))}))},t.prototype.insert=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.insert(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.update(this._name,e)];case 1:return[2,t.sent()]}}))}))},t}(s.default);t.default=a},1209:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),n(83838)),a=function(e){function t(t){var n=e.call(this)||this;return n.findPages=function(e,t,r,s,a){return o(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this._db.pageData(this._name,e,t,r,s,a)];case 1:return[2,n.sent()]}}))}))},n._name=s.baseConfig.tribeInfo.name,n._db=t,n}return r(t,e),t.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.delete(this._name,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this._db.select(this._name,e)];case 1:return[2,(t=n.sent())&&t[0]]}}))}))},t.prototype.findAll=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._db.selectAll(this._name)];case 1:return[2,e.sent()]}}))}))},t.prototype.insert=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.insert(this._name,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._db.update(this._name,e)];case 1:return[2,t.sent()]}}))}))},t}(s.default);t.default=a},415:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var n={development:{version:5,source:"emit-im",host:{ws:"wss://pins-ws.emit.technology/ws",rpc:"https://pins-api.emit.technology"}},production:{version:5,source:"emit-im",host:{ws:"wss://pins-ws.emit.technology/ws",rpc:"https://pins-api.emit.technology"}}};t.default=n.production},72698:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDB=void 0,n(45712)),s=function(){function e(e){var t=e.databaseName,n=e.tables;e=e.version;this.name=t,this.tables=n,this.createTable(this.tables,e)}return e.prototype.createDateBase=function(e,t){void 0===t&&(t=1),this.openedDB=indexedDB.open(e,t)},e.prototype.createTable=function(e,t){var n=this;void 0===t&&(t=1),indexedDB.open(this.name,t).onupgradeneeded=function(t){var r=t.target.result;e.forEach((function(e){var t;Array.from(r.objectStoreNames).includes(e.name)||(t=r.createObjectStore(e.name,{keyPath:e.keyPath,autoIncrement:e.autoIncrement}),e.indexes.forEach((function(e){n.createIndex(t,e)})))}))}},e.prototype.deleteTable=function(e,t){indexedDB.open(this.name,t).onupgradeneeded=function(n){var r=n.target.result;n.oldVersion<t&&r.deleteObjectStore(e)}},e.prototype.createIndex=function(e,t){var n={};t.unique&&(n.unique=t.unique),t.multiEntry&&(n.multiEntry=t.multiEntry),e.createIndex(t.index,t.relativeIndex,n)},e.prototype.connect=function(){var e=this;return new Promise((function(t,n){var r=indexedDB.open(e.name,e.version);r.onsuccess=function(e){t(e.target.result)},r.onerror=function(e){n(e)}}))},e.prototype.close=function(){this.connect().then((function(e){e.close()}))},e.prototype.insert=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new i.Table(e,n).insert(t).then(r).catch(o)}))}))},e.prototype.select=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new i.Table(e,n).select(t).then((function(e){r(e)})).catch((function(e){o(e)}))}))}))},e.prototype.selectId=function(e,t){var n=this;return new Promise((function(r,o){n.connect().then((function(n){new i.Table(e,n).selectId(t).then((function(e){r(e)})).catch((function(e){o(e)}))}))}))},e.prototype.some=function(e,t,n){var r=this;return new Promise((function(o,s){r.connect().then((function(r){new i.Table(e,r).some(t,n).then((function(e){o(e)})).catch((function(e){s(e)}))}))}))},e.prototype.pageData=function(e,t,n,r,o,s){var a=this;return new Promise((function(u,c){a.connect().then((function(a){new i.Table(e,a).pageData(t,n,r,o,s).then((function(e){u(e)})).catch((function(e){c(e)}))}))}))},e.prototype.update=function(e,t){return r(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){return[2,new Promise((function(r,o){n.connect().then((function(n){new i.Table(e,n).update(t).then((function(e){r(e)})).catch((function(n){console.log(e,t),console.log(n),r(!0)}))}))}))]}))}))},e.prototype.delete=function(e,t){return r(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){return[2,new Promise((function(r,o){n.connect().then((function(n){new i.Table(e,n).delete(t).then((function(e){r(e)})).catch((function(n){console.log(e,t),console.log(n),r(!0)}))}))}))]}))}))},e.prototype.selectAll=function(e){var t=this;return new Promise((function(n,r){t.connect().then((function(t){new i.Table(e,t).selectAll().then((function(e){n(e)})).catch((function(e){r(e)}))}))}))},e.prototype.clearTable=function(e){var t=this;return new Promise((function(n,r){t.connect().then((function(t){new i.Table(e,t).clear().then((function(e){n(e)})).catch((function(e){r(e)}))}))}))},e}();t.IndexedDB=s},45712:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.Table=void 0,function(){function e(e,t){this.name=e,this.db=t}return e.prototype.transaction=function(e){return this.db.transaction([this.name],!0===(e=void 0===e||e)?"readwrite":"readonly")},e.prototype.request=function(){return this.transaction().objectStore(this.name)},e.prototype.select=function(e){return n(this,void 0,void 0,(function(){var t,n,o,i,s,a,u,c,l,f,d,h,p,b,v,g,y,w=this;return r(this,(function(r){switch(r.label){case 0:if(1!=Object.keys(e).length)return[3,1];for(o in e)n=e[t=o];return[2,new Promise((function(e,r){var o=w.request().index(t).getAll(n);o.onsuccess=function(t){e(t.target.result)},o.onerror=function(e){r(e.target.result)}}))];case 1:for(a in i=[],s=[],e)s.push(a);u=0,r.label=2;case 2:return u<s.length?(c=s[u],[4,this._iSelect(c,e[c])]):[3,5];case 3:c=r.sent(),i.push(c),r.label=4;case 4:return u++,[3,2];case 5:for(l=[],f=0,d=i;f<d.length;f++)for(h=d[f],p=0,b=h;p<b.length;p++){for(y in v=b[p],g=!0,e)if(v[y]!=e[y]){g=!1;break}g&&l.push(v)}return[2,l]}}))}))},e.prototype._iSelect=function(e,t){return n(this,void 0,void 0,(function(){var n=this;return r(this,(function(r){return[2,new Promise((function(r,o){var i=n.request().index(e).getAll(t);i.onsuccess=function(e){r(e.target.result)},i.onerror=function(e){o(e.target.result)}}))]}))}))},e.prototype.selectId=function(e){var t=this;return new Promise((function(n,r){var o=t.request().get(e);o.onsuccess=function(e){n(e.target.result)},o.onerror=function(e){r(e.target.result)}}))},e.prototype.selectAll=function(){var e=this;return new Promise((function(t,n){var r=e.request().getAll();r.onsuccess=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.result)}}))},e.prototype.some=function(e,t){var n,r,o,i=this;for(o in e)r=e[n=o];return new Promise((function(e,o){var s=[];i.request().index(n).openCursor(r,"prev").onsuccess=function(n){(n=n.target.result)&&(s.push(n.value),s.length<t)?n.continue():e(s)}}))},e.prototype.pageData=function(e,t,n,r,o){var i=this;return void 0===o&&(o=10),new Promise((function(s,a){var u=[],c=i.request().index(e),l=n?IDBKeyRange.bound(t,n):IDBKeyRange.only(t),f=c.openCursor(l,"prev"),d=c.count(l),h=null;f.onsuccess=function(e){(e=e.target.result)?h===o-1?(u.push(e.value),s({data:u,total:d?d.result:0})):null===h&&1!==r?(h=0,e.advance((r-1)*o)):(h++,u.push(e.value),e.continue()):s({data:u,total:0})},f.onerror=function(e){console.log("read data failed",e),a(e)}}))},e.prototype.update=function(e){var t=this;return new Promise((function(n,r){var o=t.request().put(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}}))},e.prototype.insert=function(e){var t=this;return new Promise((function(n,r){var o=t.request().add(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}}))},e.prototype.delete=function(e){var t=this;return new Promise((function(n,r){t.select(e).then((function(r){r.length?r.forEach((function(r,o,i){var s,a=(s=t.request()).keyPath;(s=s.delete(r[a])).onsuccess=function(e){o===i.length-1&&n(e)},s.onerror=function(t){console.log("delete error: ",e,r,o,t),o===i.length-1&&n(!0)}})):n(!0)})).catch((function(e){r(e)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){var r=e.request().clear();r.onsuccess=function(e){t(e)},r.onerror=function(e){n(e)}}))},e}());t.Table=o},57623:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRpc=void 0,n(43550));t.BaseRpc=function(e){var t=this;this.post=function(e,n,s){return r(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,i.default.post("".concat(this._url).concat(e),n,{headers:{"Content-Type":"application/json",AuthToken:s}})];case 1:return[2,t.sent().data]}}))}))},this._url=e}},33082:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(57623),t)},57213:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),n(5092)),s=n(40602),a=new function(){var e=this;this.count=0,this.init=function(t,n){return r(e,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return 0!=this.count++?[3,2]:(e=function(e){console.log("callback msg",e),u({messageId:-1,method:i.Method.listenerMessage,data:e,result:e})},[4,this.tribeService.init(t,n,e)]);case 1:r.sent(),r.label=2;case 2:return[2,Promise.resolve(!0)]}}))}))},this.getPinnedMessageArray=function(t,n,i,s){return r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.tribeService.getMessageWithPinned(t,n,i,s)];case 1:return[2,e.sent()]}}))}))},this.checkStatusAndSetAuthToken=function(t,n){return r(e,void 0,void 0,(function(){return o(this,(function(e){return[2,this.tribeService.status(t,n)]}))}))},this.tribeService=new s.TribeService};function u(e){self.postMessage(e)}self.addEventListener("message",(function(e){if(e&&e.data&&e.data.method){var t=e.data;switch(t.method){case i.Method.init:a.init(t.data.tribeId,t.data.authToken).then((function(e){t.result=e,u(t)})).catch((function(e){t.error="string"==typeof e?e:e.message,u(t)}));break;case i.Method.getPinnedMessageArray:a.getPinnedMessageArray(t.data.tribeId,t.data.pageNo,t.data.pageSize,t.data.conditions).then((function(e){t.result=e,u(t)})).catch((function(e){t.error="string"==typeof e?e:e.message,u(t)}));break;case i.Method.checkAlive:a.checkStatusAndSetAuthToken(t.data.tribeId,t.data.authToken).then((function(e){t.result=e,u(t)})).catch((function(e){t.error="string"==typeof e?e:e.message,u(t)}));break;default:console.log("default message",t)}}}))},40602:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(78816),t)},78816:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,(u=o?[2&u[0],o.value]:u)[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3]))i.label=u[1];else if(6===u[0]&&i.label<o[1])i.label=o[1],o=u;else{if(!(o&&i.label<o[2])){o[2]&&i.ops.pop(),i.trys.pop();continue}i.label=o[2],i.ops.push(u)}}u=t.call(e,i)}catch(a){u=[6,a],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},a=(Object.defineProperty(t,"__esModule",{value:!0}),t.TribeService=void 0,n(5092)),u=n(33082),c=n(415),l=n(88965),f=n(76710),d=n(96765),h=n(1209),p=n(91932),b=function(e){function t(){var t=e.call(this,c.default.host.rpc)||this,r=(t.db_init=0,t.init_count=0,t.initDb=function(e){0==t.db_init++&&(t._db=(new p.IndexedDBClass).initDatabase("emit_im_".concat(e),c.default.version),t.messageCollection=new f.default(t._db),t.groupMsgCollection=new d.default(t._db),t.tribeInfoCollection=new h.default(t._db))},t.getMessageCollection=function(e){return t.initDb(e),t.messageCollection},t.getGroupMsgCollection=function(e){return t.initDb(e),t.groupMsgCollection},t.getTribeInfoCollection=function(e){return t.initDb(e),t.tribeInfoCollection},t.init=function(e,n,r){return o(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return 0!=this.init_count++?[3,3]:(console.log("init tribe worker service ..."),this.tribeId=e,this.authToken=n,this._cb=r,[4,this.indexGroupMsg()]);case 1:return t.sent(),[4,this.setConnectWs()];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.terminal=function(){t._wsOrigin&&(t._wsOrigin.close(),t._wsOrigin=null),t._wsIntervalId&&clearInterval(t._wsIntervalId)},t.tribeInfo=function(){return o(t,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.post("/tribe/tribeInfo",{tribeId:this.tribeId},this.authToken)];case 1:return(e=t.sent())&&0==e.code?[2,Promise.resolve(e.data)]:[2,Promise.reject(e.message)]}}))}))},t.tribeRoles=function(){return o(t,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.post("/tribe/tribeRoles",{tribeId:this.tribeId},this.authToken)];case 1:return(e=t.sent())&&0==e.code?e.data?[2,Promise.resolve(e.data)]:[2,[]]:[2,Promise.reject(e.message)]}}))}))},t.userCheckAuth=function(){return o(t,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.post("/user/checkAuth",null,this.authToken)];case 1:return(e=t.sent())&&0==e.code?[2,Promise.resolve(e.data.userName)]:[2,Promise.reject(e.message)]}}))}))},t.addWsListener=function(e){var n,r,o,i=t.authToken,s=t.tribeId;t._wsOrigin&&(t._wsOrigin.addEventListener("open",(function(e){console.log("opened"),t._status=a.WsStatus.active,t._wsOrigin.send(JSON.stringify({tribeId:s,authToken:i})),r()})),t._wsOrigin.addEventListener("close",(function(e){console.log("closed"),t._status=a.WsStatus.inactive})),t._wsOrigin.addEventListener("error",(function(e){console.log("error, connect after 10s later:",e),t._status=a.WsStatus.inactive})),t._wsOrigin.addEventListener("message",(function(n){t._status=a.WsStatus.active,n.data&&-1<n.data.indexOf("pong")?o():e?e(n.data):console.log("unset service callback function!")})),n=function(){t._status=a.WsStatus.inactive,console.log("pong timeout ,reconnect...")},r=function(){setTimeout((function(){t._wsOrigin.send("ping"),t.pongTimeout=setTimeout((function(){n()}),1e4)}),1e4)},o=function(){clearTimeout(t.pongTimeout),r()})},t.connectOrigin=function(e){var n=t.tribeId;t._cbInner=e,console.log("connect to [%s] websocket....",n),t.connect()},t.connect=function(){t._wsOrigin?(console.log("check ws status=[%d]",WebSocket[t._wsOrigin.readyState]),t._wsOrigin.readyState==WebSocket.CLOSED?(t._wsOrigin=new WebSocket(c.default.host.ws),t.addWsListener(t._cbInner)):t._wsOrigin.readyState==WebSocket.OPEN&&t._wsOrigin.send(JSON.stringify({tribeId:t.tribeId,authToken:t.authToken}))):(console.log("ws is null, new web socket, cb: ",t._cbInner),t._cbInner?(t._wsOrigin=new WebSocket(c.default.host.ws),t.addWsListener(t._cbInner)):console.log("not set service callback function..."))},t.reconnect=function(){console.log("websocket reconnect... ws status = ",t._status);try{t.userCheckAuth().then((function(){t.connect()})).catch((function(e){console.error(e),t._status=a.WsStatus.tokenInvalid}))}catch(r){console.error(r)}},t.indexGroupMsg=function(){return o(t,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return[4,this.groupIds()];case 1:return e=n.sent(),[4,this.tribeInfo()];case 2:return t=n.sent(),[4,this.storeTribeInfoIndex(t)];case 3:return n.sent(),[4,this.createGroupMsg(e,!1)];case 4:return n.sent(),[2]}}))}))},t.groupIds=function(){return o(t,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.post("/tribe/groupIds",{tribeId:this.tribeId},this.authToken)];case 1:return(e=t.sent())&&0==e.code?[2,Promise.resolve(e.data)]:[2,Promise.reject(e.message)]}}))}))},t.createGroupMsg=function(e,n){return void 0===e&&(e=[]),void 0===n&&(n=!1),o(t,void 0,void 0,(function(){var t,r,o,u,c,f,d,h,p,b;return i(this,(function(i){switch(i.label){case 0:if(!e||0==e.length)return[2,Promise.resolve()];t=[],d=0,i.label=1;case 1:return d<e.length?(p=e[d],[4,this.getGroupMsgCollection(this.tribeId).find({groupId:p})]):[3,4];case 2:(c=i.sent())||t.push({groupId:p,seq:d+1+""}),i.label=3;case 3:return d++,[3,1];case 4:if(!(0<t.length))return[3,16];r=0,o=t,i.label=5;case 5:return r<o.length?(u=o[r],[4,this.post("/tribe/groupedMsg",{groupIds:[u.groupId],withDraft:n},this.authToken)]):[3,16];case 6:return(c=i.sent())&&0==c.code?0==c.data.length?[2,Promise.reject("groupId =[".concat(e,"] con not match the results"))]:(f=c.data[0]).records&&0<f.records.length?((b=JSON.parse(JSON.stringify(f.records[0]))).msgType=a.MessageType.Divide,b.msgStatus=a.MessageStatus.pinned,b.seq=new l.default(b.seq).minus(1).toString(10),b.timestamp=b.timestamp-1,b.id=b.id+Date.now(),console.log("========== create pinned message:",b),[4,this.storeMessageIndex([b],b.groupId,f.roles)]):[3,8]:[3,14];case 7:i.sent(),i.label=8;case 8:d=0,i.label=9;case 9:return d<c.data.length?(h=c.data[d],p=u.groupId,h.groupId=p,h.seq=u.seq,b=s([],h.records,!0),[4,this.storeMessageIndex(b,p,h.roles)]):[3,13];case 10:return i.sent(),h.records=[],[4,this.getGroupMsgCollection(this.tribeId).insert(h)];case 11:i.sent(),i.label=12;case 12:return d++,[3,9];case 13:return[3,15];case 14:return[2,Promise.reject(c.message)];case 15:return r++,[3,5];case 16:return[2,Promise.resolve()]}}))}))},t._tribeIdDeletedKey=function(e){return e===a.MessageStatus.removed?1:2},t.storeMessageIndex=function(e,n,r){return o(t,void 0,void 0,(function(){var t,o,s,u,c;return i(this,(function(l){switch(l.label){case 0:console.log("======== store message",e),t=function(e){var t,s,u,c,l;return i(this,(function(i){switch(i.label){case 0:return e.msgType!=a.MessageType.Pin?[3,3]:[4,o.clearUnPinnedMessages()];case 1:return i.sent(),[4,o.indexGroupMsg()];case 2:return i.sent(),[2,"continue"];case 3:return e.msgType==a.MessageType.UpdateTribe?[2,"continue"]:(e.groupId=n,e.actor=r.find((function(t){return t.id==e.role})),[4,o.getMessageCollection(o.tribeId).find({id:e.id})]);case 4:return t=i.sent(),s=o._tribeIdDeletedKey(e.msgStatus),e.deleted=s,e.tribeId=o.tribeId,t?e.msgStatus!==a.MessageStatus.removed?[3,7]:[4,o.getMessageCollection(o.tribeId).delete({id:e.id})]:[3,10];case 5:return i.sent(),[4,o.getMessageCollection(o.tribeId).insert(e)];case 6:return i.sent(),[3,9];case 7:for(s=Object.keys(e),u=0,c=s;u<c.length;u++)l=c[u],t[l]=e[l];return[4,o.getMessageCollection(o.tribeId).update(t)];case 8:i.sent(),i.label=9;case 9:return[3,12];case 10:return[4,o.getMessageCollection(o.tribeId).insert(e)];case 11:i.sent(),i.label=12;case 12:return[2]}}))},o=this,s=0,u=e,l.label=1;case 1:return s<u.length?(c=u[s],[5,t(c)]):[3,4];case 2:l.sent(),l.label=3;case 3:return s++,[3,1];case 4:return[2]}}))}))},t.clearUnPinnedMessages=function(){return o(t,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.getMessageCollection(this.tribeId).delete({groupId:""})];case 1:return e.sent(),[2]}}))}))},t.storeTribeInfoIndex=function(e){return o(t,void 0,void 0,(function(){var t,n,r,o,s;return i(this,(function(i){switch(i.label){case 0:return[4,this.getTribeInfoCollection(e.tribeId).find({tribeId:e.tribeId})];case 1:if(!(t=i.sent()))return[3,3];for(n=Object.keys(e),r=0,o=n;r<o.length;r++)s=o[r],t[s]=e[s];return[4,this.getTribeInfoCollection(e.tribeId).update(t)];case 2:return i.sent(),[3,5];case 3:return[4,this.getTribeInfoCollection(e.tribeId).insert(e)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.getMessageWithPinned=function(e,n,r,s){return o(t,void 0,void 0,(function(){var t,o,u,c,l,f,d,h,p,b,v,g;return i(this,(function(i){switch(i.label){case 0:return t=[e,this._tribeIdDeletedKey(a.MessageStatus.pinned),0],o=[e,this._tribeIdDeletedKey(a.MessageStatus.pinned),Math.floor(Date.now()/1e3)+3600],g="tribeIdAndTimestamp",s&&3==s.length&&(g=s[0],t=s[1],o=s[2]),console.log(g,t,o,"condition========="),[4,this.getMessageCollection(e).findPages(g,t,o,n,r)];case 1:return u=i.sent(),console.log("============== get rest : ",u),c=u.data,l=[],[4,this.getTribeInfoCollection(e).find({tribeId:e})];case 2:f=i.sent(),d=null,c.reverse(),h=0,p=c,i.label=3;case 3:return h<p.length?(b=p[h],d=b.msgType!==a.MessageType.Divide&&b.msgType!==a.MessageType.Role?(b.hideTime=d&&d.role==b.role&&d.groupId==b.groupId&&Math.floor(d.timestamp/300)==Math.floor(b.timestamp/300)?1:2,d&&(d.owner==f.keeper&&b.owner!==f.keeper||d.owner!==f.keeper&&b.owner==f.keeper)&&(b.groupId||(b.hideTime=2)),{role:b.role,timestamp:b.timestamp,groupId:b.groupId,owner:b.owner}):(b.hideTime=2,null),[4,this.getGroupMsgCollection(e).find({groupId:b.groupId})]):[3,8];case 4:return v=i.sent(),!b.replayToMsgId||b.replayMsg?[3,6]:[4,this.getMessageCollection(e).find({id:b.replayToMsgId})];case 5:(g=i.sent())&&(b.replayMsg=g),i.label=6;case 6:v?l.push({theme:v.theme,seq:v.seq,roles:v.roles,records:[b],groupId:v.groupId,index:0}):f&&l.push({theme:f.theme,seq:"",roles:f.roles,records:[b],groupId:"",index:0}),i.label=7;case 7:return h++,[3,3];case 8:return[2,{total:u.total,data:l}]}}))}))},t.status=function(e,n){return t.authToken=n,t.tribeId=e,t._status!==a.WsStatus.active&&t.reconnect(),t._status},t.setConnectWs=function(){t.connectOrigin((function(e){return o(t,void 0,void 0,(function(){var t,n,r,o,u,c,f,d,h,p,b,v,g,y,w;return i(this,(function(_){switch(_.label){case 0:return[4,this._lock()];case 1:t=_.sent(),_.label=2;case 2:return _.trys.push([2,12,13,14]),(f=JSON.parse(e)).msgs?(n=f.msgs,r=f.tribeInfo,u=o=r,[4,this.tribeRoles()]):[3,11];case 3:return u.roles=_.sent(),[4,this.storeTribeInfoIndex(r)];case 4:return _.sent(),c=s([],n,!0),[4,this.getMessageCollection(o.tribeId).findPages("tribeIdDeletedAndSeq",[o.tribeId,2,"0000000000000000000"],[o.tribeId,2,new l.default(1e20).minus(1).toString(10)],1,2)];case 5:f=_.sent(),console.log("rest",f),0<f.data.length&&(d=f.data[0].seq,c=c.filter((function(e){return e.msgType==a.MessageType.Pin||e.msgType==a.MessageType.UpdateTribe||0<new l.default(e.seq).comparedTo(new l.default(d))}))),c=c.filter((function(e){return e.msgType!=a.MessageType.Support})),h=[],p=function(e){var t;return i(this,(function(n){switch(n.label){case 0:return e.replayToMsgId?(t=c.find((function(t){return t.id==e.replayToMsgId})))?[3,2]:[4,b.getMessageCollection(o.tribeId).find({id:e.replayToMsgId})]:[3,3];case 1:t=n.sent(),n.label=2;case 2:e.replayMsg=t,n.label=3;case 3:return h.push(e),[2]}}))},b=this,v=0,g=c,_.label=6;case 6:return v<g.length?(y=g[v],[5,p(y)]):[3,9];case 7:_.sent(),_.label=8;case 8:return v++,[3,6];case 9:return 0<h.length?[4,this.storeMessageIndex(h,"",o.roles)]:[3,11];case 10:_.sent(),this._cb?(y=this.convertMessagesToPinnedSticky(h,o.roles,r),this._cb(y)):console.log("unset callback function"),_.label=11;case 11:return[3,14];case 12:return w=_.sent(),console.error(w),[3,14];case 13:return t(),console.log("release ..."),[7];case 14:return[2]}}))}))}))},t.convertMessagesToPinnedSticky=function(e,t,n){if(e&&n&&t){for(var r=[],o=0,i=e;o<i.length;o++){var s=i[o];r.push({theme:n.theme,seq:s.seq,roles:t,records:[s],groupId:"",index:0})}return r}return[]},n(15413));return t._lock=r(),t._status=a.WsStatus._,t}return r(t,e),t}(u.BaseRpc);t.TribeService=b},5092:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.WsStatus=t.AirdropType=t.MessageStatus=t.MessageType=t.Method=void 0,(n=t.Method||(t.Method={}))[n._=0]="_",n[n.init=1]="init",n[n.getPinnedMessageArray=2]="getPinnedMessageArray",n[n.checkAlive=3]="checkAlive",n[n.listenerMessage=4]="listenerMessage",function(e){e.Dice="dice",e.Role="role",e.Text="text",e.Expression="expression",e.Theme="theme",e.Airdrop="airdrop",e.Support="support",e.Divide="divide",e.UpdateTribe="updateTribe",e.Pin="pin"}(t.MessageType||(t.MessageType={})),function(e){e[e.dashed=0]="dashed",e[e.pinned=2]="pinned",e[e.removed=3]="removed"}(t.MessageStatus||(t.MessageStatus={})),function(e){e.Random="random",e.Average="average"}(t.AirdropType||(t.AirdropType={})),function(e){e[e._=0]="_",e[e.inactive=1]="inactive",e[e.active=2]="active",e[e.tokenInvalid=3]="tokenInvalid"}(t.WsStatus||(t.WsStatus={}))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.m=e,n.x=()=>{var e=n.O(void 0,[614],(()=>n(57213)));return e=n.O(e)},(()=>{var e=[];n.O=(t,r,o,i)=>{if(!r){var s=1/0;for(l=0;l<e.length;l++){for(var[r,o,i]=e[l],a=!0,u=0;u<r.length;u++)(!1&i||s>=i)&&Object.keys(n.O).every((e=>n.O[e](r[u])))?r.splice(u--,1):(a=!1,i<s&&(s=i));if(a){e.splice(l--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[r,o,i]}})(),n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".8988fcf8.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="./",(()=>{var e={213:1};n.f.i=(t,r)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkemit_pins=self.webpackChunkemit_pins||[],r=t.push.bind(t);t.push=t=>{var[o,i,s]=t;for(var a in i)n.o(i,a)&&(n.m[a]=i[a]);for(s&&s(n);o.length;)e[o.pop()]=1;r(t)}})(),(()=>{var e=n.x;n.x=()=>n.e(614).then(e)})();n.x()})();
//# sourceMappingURL=213.f21f8c87.chunk.js.map